/*! 1.0.0 2015-08-31 */
"use strict";function showNotice(a,b,c,d){var e=b?b:"请稍候...",d=d||1500,f=jQuery("#js-notice");f.find(".inner").html(e),f.show(),c||setTimeout(function(){f.hide()},d)}function hideNotice(){jQuery("#js-notice").hide()}function closeToElement(a,b,c){if(a.length&&b.length){c=c||"&nbsp;";var d='<div id="js-animate-shadow" style="display: none; background-color: #ddd; border: solid 1px darkgray; position: static; top: 0px; z-index: 100000;">'+c+"</div>";jQuery("#js-animate-shadow").length||jQuery("body").prepend(d),jQuery("#js-animate-shadow").width(a.css("width")).height(a.css("height")).css("top",a.offset().top).css("left",a.offset().left).css("opacity",.5).css("position","absolute").show().animate({width:b.innerWidth(),height:b.innerHeight(),top:b.offset().top,left:b.offset().left},{duration:880}).animate({opacity:0},{duration:100,complete:function(){jQuery("#js-animate-shadow").hide()}})}}function showLoginDialog(){if(!CURRENT_USER){var a=jQuery("#js_login_dialog");a.length||jQuery.ajax({url:"/sessions/dialog",success:function(b){b&&(jQuery("body").append(b),a=jQuery("#js_login_dialog"))},dataType:"html",async:!1}),a.dialog({title:"登录",resizable:!1,modal:!0,width:260})}}jQuery(function(){Bbt.Main.setAjaxHeader().showLoginPopupListener().unReadNotice().userNameDropDownListener().clickStatListener().searchInputAutocompleteListener().validateSearchInputListener().goToTopListener().globalAjaxErrorListener().loginListener().collectionListener().closeUnreadNoticeListener().fixPlaceholderListener().promptListener().dropdownListener().encodeSearchUriListener().shareImg2SnsListener().showWeixinQrCode().closeBottomFloat().baiduClickStat()});var Bbt=Bbt||{Main:{},Plans:{}};Bbt.Main={setAjaxHeader:function(){var a=this;return jQuery.ajaxSetup({beforeSend:function(a){a.setRequestHeader("CSRFToken",jQuery("meta[name='CSRFToken']").attr("content"))}}),a},encodeSearchUriListener:function(){var a=this;return jQuery(window).load(function(){jQuery("a[href^=\\/s\\/]").each(function(){jQuery(this).attr("href",encodeURI(jQuery(this).attr("href")))})}),a},showWeixinQrCode:function(){var a=this;return jQuery("#footer").find(".wechat").hover(function(){jQuery(".js-wechat-code").show()},function(){jQuery(".js-wechat-code").hide()}),a},unReadNotice:function(){var a=this,b=jQuery("#js_header_notice_box"),c=window.WWW_DOMAIN||"http://www.beibaotu.com";return-1==location.href.indexOf(c)?a:window.CURRENT_USER?(jQuery.post(c+"/notice/unread_count",{type:""},function(a){"success"===a.status&&a.count&&(b.find(".message_box em").eq(1).text(a.count),b.show())},"json"),a):a},showLoginPopupListener:function(){var a=this;return-1!==location.href.indexOf("login")?a:(jQuery("#header .top-login").click(function(a){a.preventDefault(),jQuery(this).next(".menu-bd-panel").show()}),jQuery("#header .login-container .close").click(function(){jQuery(this).closest(".login-container").hide()}),a)},userNameDropDownListener:function(){var a=this,b=jQuery("#js_show_menu_usrs"),c=jQuery("#js_header_user_down_list"),d=jQuery("#js-header-myplan"),e=jQuery("#js-header-myplan-list");return b.add(c).hover(function(){b.addClass("menu_usrs_hover"),c.show()},function(){b.removeClass("menu_usrs_hover"),c.hide()}),d.add(e).hover(function(){e.find("a").length&&e.show(),d.addClass("menu_usrs_hover")},function(){d.removeClass("menu_usrs_hover"),e.hide()}),a},closeUnreadNoticeListener:function(){var a=this,b=jQuery("#js_header_notice_box");return b.find(".close").click(function(){b.hide();var a=window.WWW_DOMAIN||"http://www.beibaotu.com";jQuery.ajax({url:a+"/notice/close_tip",dataType:"jsonp"})}),a},clickStatListener:function(){var a=this;return jQuery(".create-plan, .create_plan").click(function(){var a=jQuery(this).attr("id");a&&jQuery.post("/clicks",{name:a},"json")}),a},searchInputAutocompleteListener:function(){var a=this;if("autocomplete"in jQuery("#input_search")){jQuery.ui.autocomplete.prototype._renderItem=function(a,b){var c=this.term.split(" ").join("|"),d=new RegExp("("+c+")","gi"),e=b.label.replace(d,"<b>$1</b>");return jQuery("<li></li>").data("item.autocomplete",b).append("<a title='"+b.label+"'>"+e+"</a>").appendTo(a)};var b=SEARCH_DOMAIN+"/bbtsearch/interface";jQuery("#input_search").autocomplete({source:function(a,c){jQuery.ajax({url:b,data:{cmd:"suggestSearch",kw:a.term},dataType:"jsonp",cache:!0,success:function(b){return b.list?void c(jQuery.map(b.list.item,function(b){b.itemValue.replace(a.term,"<b>"+a.term+"</b>");return{value:b.itemValue}})):void c("")}})},delay:300,minChars:1,select:function(a,b){location.href=window.WWW_DOMAIN+"/s/"+encodeURIComponent(b.item.value)}})}return a},validateSearchInputListener:function(){var a=this;return jQuery("#input_search").closest("form").submit(function(){var a=jQuery("#input_search");return a.isEmptyVal()||a.val()===a.attr("placeholder")?(showNotice(a,"搜索条件不能为空！"),a.focus(),!1):void jQuery(this).attr("action",window.WWW_DOMAIN+"/s/"+encodeURI(a.val()))}),a},goToTopListener:function(){var a=this,b=jQuery("#go_to_top"),c=jQuery(window);return b.click(function(){jQuery("html, body").animate({scrollTop:0},{duration:300})}),c.scroll(function(){var a=c.scrollTop();a>0?(jQuery.browser.msie&&jQuery.browser.version<=6&&b.css("top",a+c.height()-100),b.is(":visible")||b.show()):(jQuery.browser.msie&&jQuery.browser.version<=6&&b.css("top",""),b.is(":visible")&&b.hide())}),a},globalAjaxErrorListener:function(){var a=this,b=jQuery("#js-notice");return b.ajaxError(function(a,c,d,e){if(!navigator.onLine)return b.find(".inner").html("网络无法连接，请先检查网络连接，然后再做尝试。"),void b.show();var f,g={400:"请求内容无效。",401:"当前请求需要用户验证。",403:"长时间未操作，请刷新页面。",404:"请求不存在.",500:"服务器错误。",503:"服务器暂不可用。"};c.status?f=g[c.status]:"timeout"===e?f="请求超时，请稍候重试。":"abort"===e?f="请求被服务器终止，请稍候重试。":"parsererror"===e&&(f="解析返回结果失败，请稍候重试。"),f&&(b.find(".inner").html(f),b.show(),setTimeout(function(){b.fadeOut()},3e3))}),a},loginListener:function(){var a=this,b=jQuery("#header #username"),c=jQuery("#header #password"),d=jQuery("#header #login_form"),e=jQuery("#header #login-notice"),f=function(a){e.html(a),b.focus()};return d.submit(function(){return b.isEmptyVal()||c.isEmptyVal()?f("用户名和密码不能为空"):(f("正在努力为你登录..."),jQuery.post(d.attr("action"),{username:b.val(),password:c.val()},function(a){"success"===a.status?location.reload():f(a.desc)},"json")),!1}),jQuery.browser.msie&&jQuery.browser.version<9&&c.keydown(function(a){13==a.keyCode&&d.trigger("submit")}),a},collectionListener:function(){var a=this;return jQuery(document).on("click",".js_add2collect",function(){var a=jQuery(this),b=a.attr("item_sid"),c=a.attr("item_type"),d=a.attr("collection_id");return 6!==jQuery.trim(b).length||0===jQuery.trim(c).length?void showNotice(a,"参数错误，不能收藏"):void(a.hasClass("collect")?jQuery.post("/collections",{item_sid:b,item_type:c},function(b){if("success"===b.status){a.removeClass("collect").addClass("recollect").attr("collection_id",b.newCollectionId).attr("title","取消");var c=a.find("span");c.length?c.html("已收藏"):a.html("已收藏")}else"fail"===b.status&&b.desc&&(showNotice(a,b.desc),"未登录"===b.desc&&showLoginDialog())},"json"):a.hasClass("recollect")&&d&&jQuery.post("/collections/"+d,function(b){if("success"===b.status){a.removeClass("recollect").addClass("collect").removeAttr("collection_id").attr("title","收藏");var c=a.find("span");c.length?c.html("收藏"):a.html("收藏")}else"fail"===b.status&&b.desc&&(showNotice(a,b.desc),"未登录"===b.desc&&showLoginDialog())},"json"))}),a},fixPlaceholderListener:function(){var a=this,b="placeholder"in document.createElement("input");return b||jQuery("input[placeholder], textarea[placeholder]").each(function(){var a=jQuery(this).attr("placeholder");""==jQuery(this).val()?jQuery(this).val(a).css("color","#959595"):jQuery(this).val()==a&&jQuery(this).css("color","#959595"),jQuery(this).on("focus",function(){jQuery(this).val()==a&&jQuery(this).val("").css("color","")}),jQuery(this).on("blur",function(){""==jQuery(this).val()&&jQuery(this).val(a).css("color","#959595")})}),a},promptListener:function(){var a=this;return jQuery(".js-show-prompt").hover(function(){var a=jQuery(this).next(".js-prompt");if(a.length){var b=a.clone();jQuery("body").append(b.attr("id","js-prompt-popup")),jQuery("#js-prompt-popup").css({left:jQuery(this).offset().left-(b.width()-jQuery(this).width())/2,top:jQuery(this).offset().top-b.height()-10}).show()}},function(){var a=jQuery("#js-prompt-popup");a.length&&a.remove()}),a},recordJsErrorListener:function(){var a=this,b="",c=location.href;return jQuery.each(jQuery.browser,function(a,c){b+=a+": "+c+", "}),b=b.substring(0,b.length-2),window.onerror=function(a,d,e){var f="msg="+a+"&url="+d+"&line="+e+"&browser="+b+"&pageUrl="+c,g=new Image;return g.src="/jsLogger?"+encodeURI(f),!0},a},dropdownListener:function(){var a=this;return jQuery(".js-show-dropdown").hover(function(){jQuery(this).find(".show-dropdwon").addClass("hover"),jQuery(this).find(".js-dropdown").show()},function(){jQuery(this).find(".show-dropdwon").removeClass("hover"),jQuery(this).find(".js-dropdown").hide()}),a},shareImg2SnsListener:function(){var a=this,b={sina:"http://service.weibo.com/share/share.php",qq:"http://v.t.qq.com/share/share.php",qzone:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey",renren:"http://widget.renren.com/dialog/share"},c=encodeURIComponent(location.href);return jQuery(".js-share-img-box").on("click","a",function(){var a=jQuery(this).attr("data-share-target"),d=b[a],e=jQuery("#big-cover").attr("src")||jQuery("#js-big-img").attr("src"),e=encodeURIComponent(e),f="pic",g=encodeURIComponent("这个地方好美丽，你们都去过吗？#背包兔旅游美图# 做行程上背包兔，快来计划你的旅行吧！"),h="";a&&("sina"===a&&(h="&appkey=3428607224&ralateUid=1832549174"),"qzone"===a&&(f="pics"),"renren"===a&&(f="images"),window.open(d+"?url="+c+"&title="+g+"&"+f+"="+e+h,"","toolbar=0,scrollbars=0,location=0,menubar=0,resizable=1,width=570,height=424,top="+(screen.height-424)/2+",left="+(screen.width-570)/2))}),a},closeBottomFloat:function(){var a=this,b=jQuery("#js_bottom_box");return b.on("click",".close",function(){b.slideUp()}),a},baiduClickStat:function(){return jQuery("[data-stat]").click(function(){var a=jQuery(this).attr("data-stat");try{_hmt.push(["_trackEvent","click","btn",a])}catch(b){}}),this}},Object.keys=Object.keys||function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},function(a){a.fn.extend({isEmptyVal:function(){return!a.trim(this.val()).length},focusEnd:function(){var a=this.get(0),b=a.value.length;a.selectionStart=b,a.selectionEnd=b,a.focus()}})}(jQuery),function(a){a.extend({confirm:function(a,b,c){if(a&&b){var c=c||"确认删除吗？删除后，不可恢复。",d="js-del-confirm",e=['<div class="confirm" style="position: absolute; border:1px solid #cfcfcf; background-color:#fff; padding:10px; display: none;" id="'+d+'">','<div><span id="js-confirm-msg">'+c+"</span></div>",'<div class="confirm_btns" style="margin-top:15px; text-align:center;">','<input type="button" value="取消" id="js-confirm-cancel"style="cursor: pointer; border:none;background:url(/images/plan/ui-form-buton.png) -40px -105px no-repeat;width:38px;height:21px; color:#666;" /><input type="button" id="js-confirm-yes" value="确定" style="cursor: pointer;border:none;background:url(/images/plan/ui-form-buton.png) 0 -105px no-repeat;width:38px;height:21px; color:#fff; margin-left:10px;"/>',"</div>","</div>"],f=jQuery("#"+d),g=0,h=0;f.length?jQuery("#js-confirm-msg").html(c):(jQuery("body").append(e.join("")),f=jQuery("#"+d)),g=a.offset().top-76,h=a.offset().left-(f.width()-a.width())/2,f.css({top:g,left:h}).show(),jQuery("#js-confirm-cancel").unbind("click").click(function(){f.hide()}),jQuery("#js-confirm-yes").unbind("click").click(function(){b(),f.hide()})}},pop:function(a,b){var c='<div id="js-pop">'+b+"</div>",d=jQuery("#js-pop");d.length?d.html(b):(jQuery("body").append(c),d=jQuery("#js-pop")),d.css({position:"absolute",top:a.offset().top,left:a.offset().left,color:"red"}),d.animate({top:a.offset().top-100,fontSize:50,opacity:0},"slow",function(){d.remove()})}})}(jQuery);var Helper={map:{}};Helper.gmap={arc:function(a,b,c){var d,e,f,g,h,i,j=30,k=0,l=0,m=[],n=a.lat(),o=a.lng(),p=b.lat(),q=b.lng();for(q>o&&q-o>180&&0>o&&(o=360+o),o>q&&o-q>180&&0>q&&(q=360+q),i=0,p==n?(d=0,e=o-q):q==o?(d=Math.PI/2,e=n-p):(d=Math.atan((p-n)/(q-o)),e=(p-n)/Math.sin(d)),0==i&&(i=d+Math.PI/5),f=e/2,h=f*Math.cos(i)+o,g=f*Math.sin(i)+n,k=0;j+1>k;k++)m.push(new google.maps.LatLng(n*(1-2*l+l*l)+g*(2*l-2*l*l)+p*l*l,o*(1-2*l+l*l)+h*(2*l-2*l*l)+q*l*l)),l+=1/j;var r=new google.maps.Polyline({path:m,strokeColor:"#04B404",strokeOpacity:.8,strokeWeight:4,map:c});return r}};